# Gemini RAG Demo

## Overview
This is a React-based Retrieval Augmented Generation (RAG) demonstration interface. The application enables users to interact with a knowledge base powered by **Google's Gemini File Search API**, orchestrated via **n8n workflows**.

Users can upload documents to a synchronized Google Drive folder, view the library, and chat with an AI agent that provides grounded answers with citations linking back to the source documents.

## Features

### 1. Authentication
*   **Mock Authentication**: A simple "Sign In" toggle for demonstration purposes.
*   **Secured Views**: Restricts access to Upload, Chat, and Library views until signed in.

### 2. Upload to Knowledge Base
*   **Workflow**: Directs users to a specific Google Drive folder.
*   **Sync**: Relies on an external background scheduler (e.g., n8n) to detect new files in the folder and index them into the Gemini File Search store.

### 3. Chat with Documents
*   **n8n Integration**: Connects to an n8n webhook to process user queries.
*   **Citations**:
    *   Parses raw text responses to extract references (supports English headers like "References" and French like "Références").
    *   Renders inline citation markers (e.g., `[1]`) as interactive buttons.
    *   Displays a structured "Sources" list at the bottom of the message.
*   **Robust Linking**: Since the AI may not know the exact public URL of a private Drive file, the application constructs **Smart Search Links** (`https://drive.google.com/drive/search?q=...`) to reliably locate the specific file within the designated folder.

### 4. Document Library
*   **Mock View**: Displays a list of files currently available in the knowledge base (simulating the contents of the Drive folder).
*   **Direct Access**: Provides quick links to open the Google Drive folder.

## Technical Architecture

*   **Frontend**: React 19 (Hooks, Functional Components)
*   **Styling**: Tailwind CSS
*   **Icons**: Lucide React
*   **Build Tool**: Vite / ESBuild (implied by environment)

### Configuration Constants

To adapt this project for your own infrastructure, update the following constants in the code:

#### Google Drive Folder
Located in `components/UploadView.tsx`, `components/ChatView.tsx`, and `components/LibraryView.tsx`:
```typescript
const DRIVE_FOLDER_ID = "1pDHcsAyUSr2D-WRGJvnoE-2sOPaCk3Zz"; // Replace with your Folder ID
```

#### n8n Chat Webhook
Located in `components/ChatView.tsx`:
```typescript
const response = await fetch('https://anneroyam.app.n8n.cloud/webhook/chat', { ... });
```

## Usage Flows

### Chat Flow
1.  **Input**: User types a question.
2.  **Request**: App sends `POST` request to n8n webhook with JSON payload:
    ```json
    {
      "message": "User question",
      "sessionId": "unique-session-id"
    }
    ```
3.  **Processing**: n8n workflow queries Gemini File Search.
4.  **Response**: n8n returns JSON with `answer` and optional `citations`.
5.  **Rendering**: App parses the answer, formats citations, and generates clickable Drive links.

### Upload Flow
1.  User navigates to the "Upload Documents" tab.
2.  User clicks "Open Google Drive Folder".
3.  User uploads PDF/DOCX/TXT files directly to Google Drive.
4.  External n8n scheduler picks up files (every ~10 mins) and syncs them to Gemini.

## Citation Handling
The application features a robust regex engine in `ChatView.tsx` to handle various citation formats generated by LLMs:
*   Standard: `[1] Document Name`
*   Inverted: `Document Name [1]`
*   Headers: `References:`, `Sources:`, `Références :` (French)

It ensures that citation numbers in the text (e.g., `...according to the report [1].`) align perfectly with the source list.
